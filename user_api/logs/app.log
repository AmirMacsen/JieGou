2025-09-10 13:07:37.240 | INFO     | __main__:root:13 - Hello World
2025-09-10 13:14:11.162 | INFO     | __main__:root:17 - Hello World
2025-09-10 13:18:51.537 | INFO     | __main__:root:17 - Hello World
2025-09-10 13:18:51.538 | ERROR    | hooks.middlewares:log_middleware:19 - 请求异常: division by zero
Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 151, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x0000024EA6879C60>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\anyio\streams\memory.py", line 111, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x0000024EA6879BC0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\anyio\streams\memory.py", line 104, in receive_nowait
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\main.py", line 31, in <module>
    uvicorn.run(app, host="0.0.0.0", port=8000)
    │       │   └ <fastapi.applications.FastAPI object at 0x0000024EA73A16A0>
    │       └ <function run at 0x0000024EA753ADE0>
    └ <module 'uvicorn' from 'D:\\workspace\\py\\PythonProject\\JieGou\\user_api\\.venv\\Lib\\site-packages\\uvicorn\\__init__.py'>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\main.py", line 580, in run
    server.run()
    │      └ <function Server.run at 0x0000024EA753B060>
    └ <uvicorn.server.Server object at 0x0000024EA7541160>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x0000024EA753B100>
           │       │   └ <uvicorn.server.Server object at 0x0000024EA7541160>
           │       └ <function run at 0x0000024EA62DF7E0>
           └ <module 'asyncio' from 'D:\\develop_envs\\python\\Lib\\asyncio\\__init__.py'>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x0000024EA7560580>
           │      └ <function Runner.run at 0x0000024EA630B4C0>
           └ <asyncio.runners.Runner object at 0x0000024EA7541400>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-pack...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x0000024EA6308F40>
           │    └ <ProactorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000024EA7541400>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 706, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x0000024EA6308EA0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 677, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x0000024EA630ACA0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 2034, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x0000024EA6290A40>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x0000024EA75D2B90>()>
  File "D:\develop_envs\python\Lib\asyncio\events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <_asyncio.TaskStepMethWrapper object at 0x0000024EA75D2B90>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <_asyncio.TaskStepMethWrapper object at 0x0000024EA75D2B90>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <_asyncio.TaskStepMethWrapper object at 0x0000024EA75D2B90>()>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\protocols\http\h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000024EA7540C20>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x0000024EA75D9400>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x0000024EA75D9...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000024EA73A16A0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000024EA7540C20>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x0000024EA75D9400>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x0000024EA75D9...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x0000024EA75D9400>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x0000024EA75D9...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000024EA7543380>
          └ <fastapi.applications.FastAPI object at 0x0000024EA73A16A0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000024EA75768E0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x0000024EA75D9...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000024EA7543230>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x0000024EA7543380>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000024EA7608AE0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x0000024EA75D92B0>
                     │    └ <function log_middleware at 0x0000024EA73B40E0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000024EA7543230>

> File "D:\workspace\py\PythonProject\JieGou\user_api\hooks\middlewares.py", line 15, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x0000024EA75D92B0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000024EA7608AE0>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    raise app_exc
          └ ZeroDivisionError('division by zero')
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000024EA7608E00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024EA7609120>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000024EA75430E0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x0000024EA7543230>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x0000024EA7608E00>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024EA7609120>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x0000024EA75DA900>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000024EA7394B90>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000024EA75430E0>
          └ <function wrap_app_handling_exceptions at 0x0000024EA723A7A0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000024EA7663420>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024EA7609120>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000024EA7394B90>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000024EA7663420>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024EA7609120>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000024EA7394B90>>
          └ <fastapi.routing.APIRouter object at 0x0000024EA7394B90>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000024EA7663420>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024EA7609120>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x0000024EA723BEC0>
          └ APIRoute(path='/', name='root', methods=['GET'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000024EA7663420>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024EA7609120>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000024EA73B4900>
          └ APIRoute(path='/', name='root', methods=['GET'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000024EA7663420>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024EA7609120>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000024EA760CB90>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x0000024EA76634C0>
          └ <function wrap_app_handling_exceptions at 0x0000024EA723A7A0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x0000024EA7663600>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000024EA7609120>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x0000024EA76634C0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000024EA760CB90>
                     └ <function get_request_handler.<locals>.app at 0x0000024EA73B4720>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x0000024EA7239E40>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {}
                 │         └ <function root at 0x0000024EA73B4680>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[], dependencies=[], security_requ...

  File "D:\workspace\py\PythonProject\JieGou\user_api\main.py", line 20, in root
    c = a /b
        │  └ 0
        └ 1

ZeroDivisionError: division by zero
2025-09-10 13:29:15.098 | INFO     | routers.user:get_smscode:13 - mobile: 18888888995, code: 3785
2025-09-10 14:33:50.407 | INFO     | routers.user:get_smscode:13 - mobile: 18888888995, code: 1938
2025-09-10 14:34:08.834 | INFO     | routers.user:get_smscode:15 - mobile: 18888888995, code: 2560
2025-09-10 14:48:27.767 | INFO     | routers.user:get_smscode:15 - mobile: 18888888995, code: 3492
2025-09-10 14:49:44.206 | ERROR    | hooks.middlewares:log_middleware:19 - 请求异常: Error 22 connecting to localhost:6379. 远程计算机拒绝网络连接。.
Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 151, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000002E0E6B99C60>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream from None
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\main.py", line 19, in <module>
    uvicorn.run(app, host="0.0.0.0", port=8000)
    │       │   └ <fastapi.applications.FastAPI object at 0x000002E0E88FC590>
    │       └ <function run at 0x000002E0E8A5F1A0>
    └ <module 'uvicorn' from 'D:\\workspace\\py\\PythonProject\\JieGou\\user_api\\.venv\\Lib\\site-packages\\uvicorn\\__init__.py'>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\main.py", line 580, in run
    server.run()
    │      └ <function Server.run at 0x000002E0E8A84FE0>
    └ <uvicorn.server.Server object at 0x000002E0E8B5B380>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x000002E0E8A85080>
           │       │   └ <uvicorn.server.Server object at 0x000002E0E8B5B380>
           │       └ <function run at 0x000002E0E661F7E0>
           └ <module 'asyncio' from 'D:\\develop_envs\\python\\Lib\\asyncio\\__init__.py'>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000002E0E8A94E40>
           │      └ <function Runner.run at 0x000002E0E664B4C0>
           └ <asyncio.runners.Runner object at 0x000002E0E8B5B620>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-pack...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000002E0E6648F40>
           │    └ <ProactorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000002E0E8B5B620>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 706, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000002E0E6648EA0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 677, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000002E0E664ACA0>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 2034, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000002E0E65D0A40>
    └ <Handle Task.task_wakeup()>
  File "D:\develop_envs\python\Lib\asyncio\events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup()>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\protocols\http\h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002E0E8A44D70>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000002E0E8A47620>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000002E0E8A47...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000002E0E88FC590>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000002E0E8A44D70>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000002E0E8A47620>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000002E0E8A47...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000002E0E8A47620>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000002E0E8A47...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002E0E8A456A0>
          └ <fastapi.applications.FastAPI object at 0x000002E0E88FC590>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000002E0E89FACA0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000002E0E8A47...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002E0E8A45550>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000002E0E8A456A0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000002E0E89FAD40>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000002E0E8A474D0>
                     │    └ <function log_middleware at 0x000002E0E76D40E0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002E0E8A45550>

> File "D:\workspace\py\PythonProject\JieGou\user_api\hooks\middlewares.py", line 15, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000002E0E8A474D0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000002E0E89FAD40>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    raise app_exc
          └ ConnectionError('Error 22 connecting to localhost:6379. 远程计算机拒绝网络连接。.')
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002E0E89FADE0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002E0E89FB100>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002E0E8A45400>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000002E0E8A45550>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000002E0E89FADE0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002E0E89FB100>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000002E0E89E0C20>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000002E0E89BEAD0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000002E0E8A45400>
          └ <function wrap_app_handling_exceptions at 0x000002E0E755A7A0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002E0E8C49440>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002E0E89FB100>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000002E0E89BEAD0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002E0E8C49440>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002E0E89FB100>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000002E0E89BEAD0>>
          └ <fastapi.routing.APIRouter object at 0x000002E0E89BEAD0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002E0E8C49440>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002E0E89FB100>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000002E0E755BEC0>
          └ APIRoute(path='/user/smscode/{mobile}', name='get_smscode', methods=['GET'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002E0E8C49440>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002E0E89FB100>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000002E0E89047C0>
          └ APIRoute(path='/user/smscode/{mobile}', name='get_smscode', methods=['GET'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002E0E8C49440>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002E0E89FB100>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000002E0E8A0F110>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000002E0E8C494E0>
          └ <function wrap_app_handling_exceptions at 0x000002E0E755A7A0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000002E0E8C49620>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000002E0E89FB100>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000002E0E8C494E0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000002E0E8A0F110>
                     └ <function get_request_handler.<locals>.app at 0x000002E0E8904680>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000002E0E7559E40>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'mobile': '18888888995'}
                 │         └ <function get_smscode at 0x000002E0E76D4A40>
                 └ Dependant(path_params=[ModelField(field_info=Path(PydanticUndefined), name='mobile', mode='validation')], query_params=[], he...

  File "D:\workspace\py\PythonProject\JieGou\user_api\routers\user.py", line 16, in get_smscode
    await ttl_redis.set(mobile, code)
          │         │   │       └ '9683'
          │         │   └ '18888888995'
          │         └ <function TllRedis.set at 0x000002E0E76D4CC0>
          └ <utils.cache.TllRedis object at 0x000002E0E8AD70E0>

  File "D:\workspace\py\PythonProject\JieGou\user_api\utils\cache.py", line 9, in set
    await self.client.set(key, value, ex)
          │    │      │   │    │      └ 18000
          │    │      │   │    └ '9683'
          │    │      │   └ '18888888995'
          │    │      └ <function BasicKeyCommands.set at 0x000002E0E781C4A0>
          │    └ <redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(db=0,username=None,...
          └ <utils.cache.TllRedis object at 0x000002E0E8AD70E0>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\redis\asyncio\client.py", line 672, in execute_command
    conn = self.connection or await pool.get_connection()
           │    │                   │    └ <function ConnectionPool.get_connection at 0x000002E0E78B4220>
           │    │                   └ <redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(db=0,username=None,password=None,credential_pro...
           │    └ None
           └ <redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(db=0,username=None,...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\redis\asyncio\connection.py", line 1149, in get_connection
    await self.ensure_connection(connection)
          │    │                 └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
          │    └ <function ConnectionPool.ensure_connection at 0x000002E0E78B4400>
          └ <redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(db=0,username=None,password=None,credential_pro...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\redis\asyncio\connection.py", line 1182, in ensure_connection
    await connection.connect()
          │          └ <function AbstractConnection.connect at 0x000002E0E78BE020>
          └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\redis\asyncio\connection.py", line 296, in connect
    await self.connect_check_health(check_health=True)
          │    └ <function AbstractConnection.connect_check_health at 0x000002E0E78BE0C0>
          └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\redis\asyncio\connection.py", line 315, in connect_check_health
    raise ConnectionError(self._error_message(e))
          │               │    └ <function AbstractConnection._error_message at 0x000002E0E78BE2A0>
          │               └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
          └ <class 'redis.exceptions.ConnectionError'>

redis.exceptions.ConnectionError: Error 22 connecting to localhost:6379. 远程计算机拒绝网络连接。.
2025-09-10 14:52:01.553 | INFO     | routers.user:get_smscode:17 - mobile: 18888888995, code: 2510
2025-09-10 14:57:01.809 | INFO     | routers.user:get_smscode:17 - mobile: 18888888995, code: 5417
2025-09-10 15:20:48.663 | ERROR    | hooks.middlewares:log_middleware:19 - 请求异常: user
Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 151, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001D7DBF4E8E0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream from None
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\main.py", line 19, in <module>
    uvicorn.run(app, host="0.0.0.0", port=8000)
    │       │   └ <fastapi.applications.FastAPI object at 0x000001D7DDF0B4D0>
    │       └ <function run at 0x000001D7DE1505E0>
    └ <module 'uvicorn' from 'D:\\workspace\\py\\PythonProject\\JieGou\\user_api\\.venv\\Lib\\site-packages\\uvicorn\\__init__.py'>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\main.py", line 580, in run
    server.run()
    │      └ <function Server.run at 0x000001D7DE150860>
    └ <uvicorn.server.Server object at 0x000001D7DE1123C0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x000001D7DE150900>
           │       │   └ <uvicorn.server.Server object at 0x000001D7DE1123C0>
           │       └ <function run at 0x000001D7DB9D0B80>
           └ <module 'asyncio' from 'D:\\develop_envs\\python\\Lib\\asyncio\\__init__.py'>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001D7DE1334C0>
           │      └ <function Runner.run at 0x000001D7DBA08180>
           └ <asyncio.runners.Runner object at 0x000001D7DE112660>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-pack...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001D7DBA01BC0>
           │    └ <ProactorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001D7DE112660>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 706, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001D7DBA01B20>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 677, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001D7DBA03920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 2034, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001D7DB9796C0>
    └ <Handle Task.task_wakeup()>
  File "D:\develop_envs\python\Lib\asyncio\events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup()>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\protocols\http\h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001D7DE113CB0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001D7DE26D6D0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001D7DE26D...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001D7DDF0B4D0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001D7DE113CB0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001D7DE26D6D0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001D7DE26D...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001D7DE26D6D0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001D7DE26D...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001D7DE1F46E0>
          └ <fastapi.applications.FastAPI object at 0x000001D7DDF0B4D0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001D7DE261580>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001D7DE26D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001D7DE1F4590>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001D7DE1F46E0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001D7DE261B20>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001D7DE26D590>
                     │    └ <function log_middleware at 0x000001D7DCCD1EE0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001D7DE1F4590>

> File "D:\workspace\py\PythonProject\JieGou\user_api\hooks\middlewares.py", line 15, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001D7DE26D590>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001D7DE261B20>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    raise app_exc
          └ AttributeError('user')
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001D7DE261E40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001D7DE261DA0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001D7DE1F4440>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001D7DE1F4590>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001D7DE261E40>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001D7DE261DA0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001D7DE239480>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001D7DDE96AD0>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001D7DE1F4440>
          └ <function wrap_app_handling_exceptions at 0x000001D7DC90B420>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001D7DE2620C0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001D7DE261DA0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001D7DDE96AD0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001D7DE2620C0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001D7DE261DA0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001D7DDE96AD0>>
          └ <fastapi.routing.APIRouter object at 0x000001D7DDE96AD0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001D7DE2620C0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001D7DE261DA0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001D7DC938B80>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001D7DE2620C0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001D7DE261DA0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001D7DDF53D80>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001D7DE2620C0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001D7DE261DA0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001D7DE1B6330>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001D7DE262160>
          └ <function wrap_app_handling_exceptions at 0x000001D7DC90B420>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001D7DE2622A0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001D7DE261DA0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001D7DE262160>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000001D7DE1B6330>
                     └ <function get_request_handler.<locals>.app at 0x000001D7DDF53E20>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x000001D7DC90AAC0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'data': LoginModel(mobile='18888888995', code='8888')}
                 │         └ <function login at 0x000001D7DDF53600>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=Body(Pydant...

  File "D:\workspace\py\PythonProject\JieGou\user_api\routers\user.py", line 39, in login
    user = response.user
           └ user_info {
               id: 9045706863282225152
               username: "9045706863282225152"
               mobile: "18888888995"
               avatar: "https://avatars.gi...

AttributeError: user
2025-09-10 15:23:34.754 | ERROR    | hooks.middlewares:log_middleware:19 - 请求异常: 3 validation errors:
  {'type': 'missing', 'loc': ('response', 'user'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'access_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'refresh_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}

Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 151, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001458E29E8E0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream from None
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\main.py", line 19, in <module>
    uvicorn.run(app, host="0.0.0.0", port=8000)
    │       │   └ <fastapi.applications.FastAPI object at 0x000001458E9FF0E0>
    │       └ <function run at 0x000001458ECBF4C0>
    └ <module 'uvicorn' from 'D:\\workspace\\py\\PythonProject\\JieGou\\user_api\\.venv\\Lib\\site-packages\\uvicorn\\__init__.py'>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\main.py", line 580, in run
    server.run()
    │      └ <function Server.run at 0x000001458ECBF740>
    └ <uvicorn.server.Server object at 0x000001458EC85FD0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x000001458ECBF7E0>
           │       │   └ <uvicorn.server.Server object at 0x000001458EC85FD0>
           │       └ <function run at 0x000001458D4E0B80>
           └ <module 'asyncio' from 'D:\\develop_envs\\python\\Lib\\asyncio\\__init__.py'>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001458ECAA260>
           │      └ <function Runner.run at 0x000001458D518180>
           └ <asyncio.runners.Runner object at 0x000001458EC86270>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-pack...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001458D511BC0>
           │    └ <ProactorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001458EC86270>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 706, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001458D511B20>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 677, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001458D513920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 2034, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001458D4896C0>
    └ <Handle Task.task_wakeup()>
  File "D:\develop_envs\python\Lib\asyncio\events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup()>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\protocols\http\h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001458EC85A90>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001458EE01090>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001458EE01...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001458E9FF0E0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001458EC85A90>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001458EE01090>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001458EE01...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001458EE01090>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001458EE01...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001458ED882F0>
          └ <fastapi.applications.FastAPI object at 0x000001458E9FF0E0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001458EDA9440>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001458EE01...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001458ED881A0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001458ED882F0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001458EDA94E0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001458EE00CD0>
                     │    └ <function log_middleware at 0x000001458E851EE0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001458ED881A0>

> File "D:\workspace\py\PythonProject\JieGou\user_api\hooks\middlewares.py", line 15, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001458EE00CD0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001458EDA94E0>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    raise app_exc
          └ ResponseValidationError()
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001458ECFAFC0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001458EDA9580>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001458ED88050>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001458ED881A0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001458ECFAFC0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001458EDA9580>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001458EE01590>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001458EA25D10>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001458ED88050>
          └ <function wrap_app_handling_exceptions at 0x000001458E45B420>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001458EDF7C40>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001458EDA9580>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001458EA25D10>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001458EDF7C40>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001458EDA9580>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001458EA25D10>>
          └ <fastapi.routing.APIRouter object at 0x000001458EA25D10>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001458EDF7C40>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001458EDA9580>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001458E488B80>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001458EDF7C40>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001458EDA9580>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001458EA5C180>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001458EDF7C40>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001458EDA9580>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001458EDB0640>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001458EDF7CE0>
          └ <function wrap_app_handling_exceptions at 0x000001458E45B420>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001458EDFD260>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001458EDA9580>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001458EDF7CE0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000001458EDB0640>
                     └ <function get_request_handler.<locals>.app at 0x000001458EA5EA20>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 328, in app
    content = await serialize_response(
                    └ <function serialize_response at 0x000001458E45B100>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 177, in serialize_response
    raise ResponseValidationError(
          └ <class 'fastapi.exceptions.ResponseValidationError'>

fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'missing', 'loc': ('response', 'user'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'access_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'refresh_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}

2025-09-10 15:24:37.749 | ERROR    | hooks.middlewares:log_middleware:19 - 请求异常: 3 validation errors:
  {'type': 'missing', 'loc': ('response', 'user'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'access_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'refresh_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}

Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 151, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001458E29E8E0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream from None
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\main.py", line 19, in <module>
    uvicorn.run(app, host="0.0.0.0", port=8000)
    │       │   └ <fastapi.applications.FastAPI object at 0x000001458E9FF0E0>
    │       └ <function run at 0x000001458ECBF4C0>
    └ <module 'uvicorn' from 'D:\\workspace\\py\\PythonProject\\JieGou\\user_api\\.venv\\Lib\\site-packages\\uvicorn\\__init__.py'>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\main.py", line 580, in run
    server.run()
    │      └ <function Server.run at 0x000001458ECBF740>
    └ <uvicorn.server.Server object at 0x000001458EC85FD0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x000001458ECBF7E0>
           │       │   └ <uvicorn.server.Server object at 0x000001458EC85FD0>
           │       └ <function run at 0x000001458D4E0B80>
           └ <module 'asyncio' from 'D:\\develop_envs\\python\\Lib\\asyncio\\__init__.py'>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001458ECAA260>
           │      └ <function Runner.run at 0x000001458D518180>
           └ <asyncio.runners.Runner object at 0x000001458EC86270>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-pack...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001458D511BC0>
           │    └ <ProactorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001458EC86270>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 706, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001458D511B20>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 677, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001458D513920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 2034, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001458D4896C0>
    └ <Handle Task.task_wakeup()>
  File "D:\develop_envs\python\Lib\asyncio\events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup()>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\protocols\http\h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001458EC85A90>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001458EE02990>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001458EE02...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001458E9FF0E0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001458EC85A90>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001458EE02990>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001458EE02...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001458EE02990>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001458EE02...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001458ED882F0>
          └ <fastapi.applications.FastAPI object at 0x000001458E9FF0E0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001458EDA98A0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001458EE02...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001458ED881A0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001458ED882F0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000145902CA2A0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001458EE02710>
                     │    └ <function log_middleware at 0x000001458E851EE0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001458ED881A0>

> File "D:\workspace\py\PythonProject\JieGou\user_api\hooks\middlewares.py", line 15, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001458EE02710>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000145902CA2A0>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    raise app_exc
          └ ResponseValidationError()
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000145902CA520>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000145902CA3E0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001458ED88050>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001458ED881A0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000145902CA520>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000145902CA3E0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001458EDB2780>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001458EA25D10>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001458ED88050>
          └ <function wrap_app_handling_exceptions at 0x000001458E45B420>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000145902CA700>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000145902CA3E0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001458EA25D10>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000145902CA700>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000145902CA3E0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001458EA25D10>>
          └ <fastapi.routing.APIRouter object at 0x000001458EA25D10>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000145902CA700>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000145902CA3E0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001458E488B80>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000145902CA700>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000145902CA3E0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001458EA5C180>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000145902CA700>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000145902CA3E0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001458ED77770>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x00000145902CA7A0>
          └ <function wrap_app_handling_exceptions at 0x000001458E45B420>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000145902CA8E0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000145902CA3E0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x00000145902CA7A0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000001458ED77770>
                     └ <function get_request_handler.<locals>.app at 0x000001458EA5EA20>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 328, in app
    content = await serialize_response(
                    └ <function serialize_response at 0x000001458E45B100>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 177, in serialize_response
    raise ResponseValidationError(
          └ <class 'fastapi.exceptions.ResponseValidationError'>

fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'missing', 'loc': ('response', 'user'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'access_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'refresh_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}

2025-09-10 15:25:45.650 | ERROR    | hooks.middlewares:log_middleware:19 - 请求异常: 3 validation errors:
  {'type': 'missing', 'loc': ('response', 'user'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'access_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'refresh_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}

Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 151, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001E0D250E8E0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream from None
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\main.py", line 19, in <module>
    uvicorn.run(app, host="0.0.0.0", port=8000)
    │       │   └ <fastapi.applications.FastAPI object at 0x000001E0D346F0E0>
    │       └ <function run at 0x000001E0D372B4C0>
    └ <module 'uvicorn' from 'D:\\workspace\\py\\PythonProject\\JieGou\\user_api\\.venv\\Lib\\site-packages\\uvicorn\\__init__.py'>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\main.py", line 580, in run
    server.run()
    │      └ <function Server.run at 0x000001E0D372B740>
    └ <uvicorn.server.Server object at 0x000001E0D36F5FD0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x000001E0D372B7E0>
           │       │   └ <uvicorn.server.Server object at 0x000001E0D36F5FD0>
           │       └ <function run at 0x000001E0D1F60B80>
           └ <module 'asyncio' from 'D:\\develop_envs\\python\\Lib\\asyncio\\__init__.py'>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001E0D371A260>
           │      └ <function Runner.run at 0x000001E0D1F98180>
           └ <asyncio.runners.Runner object at 0x000001E0D36F6270>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-pack...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001E0D1F91BC0>
           │    └ <ProactorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001E0D36F6270>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 706, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001E0D1F91B20>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 677, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001E0D1F93920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 2034, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001E0D1F096C0>
    └ <Handle Task.task_wakeup()>
  File "D:\develop_envs\python\Lib\asyncio\events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup()>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\protocols\http\h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001E0D36F5A90>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001E0D37FA270>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001E0D37FA...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001E0D346F0E0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001E0D36F5A90>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001E0D37FA270>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001E0D37FA...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001E0D37FA270>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001E0D37FA...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001E0D37F82F0>
          └ <fastapi.applications.FastAPI object at 0x000001E0D346F0E0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001E0D3819260>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001E0D37FA...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001E0D37F81A0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001E0D37F82F0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001E0D38194E0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001E0D37FA120>
                     │    └ <function log_middleware at 0x000001E0D32C1EE0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001E0D37F81A0>

> File "D:\workspace\py\PythonProject\JieGou\user_api\hooks\middlewares.py", line 15, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001E0D37FA120>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001E0D38194E0>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    raise app_exc
          └ ResponseValidationError()
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001E0D3819580>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E0D38198A0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001E0D37F8050>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001E0D37F81A0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001E0D3819580>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E0D38198A0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001E0D37FB770>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001E0D3495D10>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001E0D37F8050>
          └ <function wrap_app_handling_exceptions at 0x000001E0D2ECB420>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E0D3867BA0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E0D38198A0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001E0D3495D10>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E0D3867BA0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E0D38198A0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001E0D3495D10>>
          └ <fastapi.routing.APIRouter object at 0x000001E0D3495D10>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E0D3867BA0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E0D38198A0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001E0D2EF8B80>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E0D3867BA0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E0D38198A0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001E0D34CC180>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E0D3867BA0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E0D38198A0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001E0D3801950>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001E0D3867C40>
          └ <function wrap_app_handling_exceptions at 0x000001E0D2ECB420>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E0D3867D80>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E0D38198A0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001E0D3867C40>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000001E0D3801950>
                     └ <function get_request_handler.<locals>.app at 0x000001E0D34CEA20>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 328, in app
    content = await serialize_response(
                    └ <function serialize_response at 0x000001E0D2ECB100>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 177, in serialize_response
    raise ResponseValidationError(
          └ <class 'fastapi.exceptions.ResponseValidationError'>

fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'missing', 'loc': ('response', 'user'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'access_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'refresh_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}

2025-09-10 15:26:54.619 | ERROR    | hooks.middlewares:log_middleware:19 - 请求异常: 3 validation errors:
  {'type': 'missing', 'loc': ('response', 'user'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'access_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'refresh_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}

Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 151, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001E0D250E8E0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream from None
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\main.py", line 19, in <module>
    uvicorn.run(app, host="0.0.0.0", port=8000)
    │       │   └ <fastapi.applications.FastAPI object at 0x000001E0D346F0E0>
    │       └ <function run at 0x000001E0D372B4C0>
    └ <module 'uvicorn' from 'D:\\workspace\\py\\PythonProject\\JieGou\\user_api\\.venv\\Lib\\site-packages\\uvicorn\\__init__.py'>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\main.py", line 580, in run
    server.run()
    │      └ <function Server.run at 0x000001E0D372B740>
    └ <uvicorn.server.Server object at 0x000001E0D36F5FD0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x000001E0D372B7E0>
           │       │   └ <uvicorn.server.Server object at 0x000001E0D36F5FD0>
           │       └ <function run at 0x000001E0D1F60B80>
           └ <module 'asyncio' from 'D:\\develop_envs\\python\\Lib\\asyncio\\__init__.py'>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001E0D371A260>
           │      └ <function Runner.run at 0x000001E0D1F98180>
           └ <asyncio.runners.Runner object at 0x000001E0D36F6270>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-pack...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001E0D1F91BC0>
           │    └ <ProactorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001E0D36F6270>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 706, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001E0D1F91B20>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 677, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001E0D1F93920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 2034, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001E0D1F096C0>
    └ <Handle Task.task_wakeup()>
  File "D:\develop_envs\python\Lib\asyncio\events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup()>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\protocols\http\h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001E0D36F5A90>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001E0D3871310>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001E0D3871...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001E0D346F0E0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001E0D36F5A90>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001E0D3871310>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001E0D3871...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001E0D3871310>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001E0D3871...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001E0D37F82F0>
          └ <fastapi.applications.FastAPI object at 0x000001E0D346F0E0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001E0D3819440>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001E0D3871...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001E0D37F81A0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001E0D37F82F0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001E0D4C81DA0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001E0D3871090>
                     │    └ <function log_middleware at 0x000001E0D32C1EE0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001E0D37F81A0>

> File "D:\workspace\py\PythonProject\JieGou\user_api\hooks\middlewares.py", line 15, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001E0D3871090>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001E0D4C81DA0>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    raise app_exc
          └ ResponseValidationError()
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001E0D4C81F80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E0D4C81E40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001E0D37F8050>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001E0D37F81A0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001E0D4C81F80>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E0D4C81E40>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001E0D3871950>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001E0D3495D10>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001E0D37F8050>
          └ <function wrap_app_handling_exceptions at 0x000001E0D2ECB420>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E0D4C82160>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E0D4C81E40>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001E0D3495D10>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E0D4C82160>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E0D4C81E40>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001E0D3495D10>>
          └ <fastapi.routing.APIRouter object at 0x000001E0D3495D10>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E0D4C82160>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E0D4C81E40>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001E0D2EF8B80>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E0D4C82160>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E0D4C81E40>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001E0D34CC180>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E0D4C82160>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E0D4C81E40>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001E0D3821CD0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001E0D4C82200>
          └ <function wrap_app_handling_exceptions at 0x000001E0D2ECB420>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001E0D4C82340>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001E0D4C81E40>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001E0D4C82200>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000001E0D3821CD0>
                     └ <function get_request_handler.<locals>.app at 0x000001E0D34CEA20>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 328, in app
    content = await serialize_response(
                    └ <function serialize_response at 0x000001E0D2ECB100>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 177, in serialize_response
    raise ResponseValidationError(
          └ <class 'fastapi.exceptions.ResponseValidationError'>

fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'missing', 'loc': ('response', 'user'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'access_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'refresh_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}

2025-09-10 15:27:30.242 | ERROR    | hooks.middlewares:log_middleware:19 - 请求异常: 3 validation errors:
  {'type': 'missing', 'loc': ('response', 'user'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'access_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'refresh_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}

Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 151, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x00000278FFE5E8E0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream from None
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\main.py", line 19, in <module>
    uvicorn.run(app, host="0.0.0.0", port=8000)
    │       │   └ <fastapi.applications.FastAPI object at 0x0000027880DDF0E0>
    │       └ <function run at 0x000002788109B420>
    └ <module 'uvicorn' from 'D:\\workspace\\py\\PythonProject\\JieGou\\user_api\\.venv\\Lib\\site-packages\\uvicorn\\__init__.py'>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\main.py", line 580, in run
    server.run()
    │      └ <function Server.run at 0x000002788109B6A0>
    └ <uvicorn.server.Server object at 0x0000027881065FD0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x000002788109B740>
           │       │   └ <uvicorn.server.Server object at 0x0000027881065FD0>
           │       └ <function run at 0x00000278FF8B0B80>
           └ <module 'asyncio' from 'D:\\develop_envs\\python\\Lib\\asyncio\\__init__.py'>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000002788108A260>
           │      └ <function Runner.run at 0x00000278FF8E8180>
           └ <asyncio.runners.Runner object at 0x0000027881066270>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-pack...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x00000278FF8E1BC0>
           │    └ <ProactorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x0000027881066270>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 706, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000278FF8E1B20>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 677, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000278FF8E3920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 2034, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000278FF8596C0>
    └ <Handle Task.task_wakeup()>
  File "D:\develop_envs\python\Lib\asyncio\events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup()>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\protocols\http\h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000027881065A90>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000002788114A270>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000002788114A...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x0000027880DDF0E0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x0000027881065A90>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000002788114A270>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000002788114A...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000002788114A270>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000002788114A...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000278811482F0>
          └ <fastapi.applications.FastAPI object at 0x0000027880DDF0E0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x0000027881169300>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000002788114A...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000278811481A0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000278811482F0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000027881169440>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000002788114A120>
                     │    └ <function log_middleware at 0x0000027880C41EE0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000278811481A0>

> File "D:\workspace\py\PythonProject\JieGou\user_api\hooks\middlewares.py", line 15, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000002788114A120>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x0000027881169440>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    raise app_exc
          └ ResponseValidationError()
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000278811694E0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000027881169800>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000027881148050>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000278811481A0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000278811694E0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000027881169800>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000002788114B770>
          │                            │    └ <fastapi.routing.APIRouter object at 0x0000027880E05D10>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x0000027881148050>
          └ <function wrap_app_handling_exceptions at 0x000002788087B420>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000278811B7B00>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000027881169800>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x0000027880E05D10>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000278811B7B00>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000027881169800>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x0000027880E05D10>>
          └ <fastapi.routing.APIRouter object at 0x0000027880E05D10>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000278811B7B00>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000027881169800>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000278808A8B80>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000278811B7B00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000027881169800>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x0000027880E3C0E0>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000278811B7B00>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000027881169800>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x0000027881151950>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x00000278811B7BA0>
          └ <function wrap_app_handling_exceptions at 0x000002788087B420>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000278811B7CE0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x0000027881169800>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x00000278811B7BA0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x0000027881151950>
                     └ <function get_request_handler.<locals>.app at 0x0000027880E3E980>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 328, in app
    content = await serialize_response(
                    └ <function serialize_response at 0x000002788087B100>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 177, in serialize_response
    raise ResponseValidationError(
          └ <class 'fastapi.exceptions.ResponseValidationError'>

fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'missing', 'loc': ('response', 'user'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'access_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'refresh_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}

2025-09-10 15:28:16.861 | ERROR    | hooks.middlewares:log_middleware:19 - 请求异常: 3 validation errors:
  {'type': 'missing', 'loc': ('response', 'user'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'access_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'refresh_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}

Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 151, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001BD18B3E8E0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream from None
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\main.py", line 19, in <module>
    uvicorn.run(app, host="0.0.0.0", port=8000)
    │       │   └ <fastapi.applications.FastAPI object at 0x000001BD19A5F0E0>
    │       └ <function run at 0x000001BD19D1B420>
    └ <module 'uvicorn' from 'D:\\workspace\\py\\PythonProject\\JieGou\\user_api\\.venv\\Lib\\site-packages\\uvicorn\\__init__.py'>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\main.py", line 580, in run
    server.run()
    │      └ <function Server.run at 0x000001BD19D1B6A0>
    └ <uvicorn.server.Server object at 0x000001BD19CE5FD0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x000001BD19D1B740>
           │       │   └ <uvicorn.server.Server object at 0x000001BD19CE5FD0>
           │       └ <function run at 0x000001BD185C0B80>
           └ <module 'asyncio' from 'D:\\develop_envs\\python\\Lib\\asyncio\\__init__.py'>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001BD19D0A260>
           │      └ <function Runner.run at 0x000001BD185F8180>
           └ <asyncio.runners.Runner object at 0x000001BD19CE6270>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-pack...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001BD185F1BC0>
           │    └ <ProactorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001BD19CE6270>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 706, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001BD185F1B20>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 677, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001BD185F3920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 2034, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001BD185696C0>
    └ <Handle Task.task_wakeup()>
  File "D:\develop_envs\python\Lib\asyncio\events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup()>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\protocols\http\h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001BD19CE5A90>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001BD19DCA270>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001BD19DCA...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001BD19A5F0E0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001BD19CE5A90>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001BD19DCA270>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001BD19DCA...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001BD19DCA270>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001BD19DCA...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001BD19DC82F0>
          └ <fastapi.applications.FastAPI object at 0x000001BD19A5F0E0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001BD19D5AF20>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001BD19DCA...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001BD19DC81A0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001BD19DC82F0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001BD19DE9440>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001BD19DCA120>
                     │    └ <function log_middleware at 0x000001BD198C1EE0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001BD19DC81A0>

> File "D:\workspace\py\PythonProject\JieGou\user_api\hooks\middlewares.py", line 15, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001BD19DCA120>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001BD19DE9440>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    raise app_exc
          └ ResponseValidationError()
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001BD19DE94E0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001BD19DE9800>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001BD19DC8050>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001BD19DC81A0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001BD19DE94E0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001BD19DE9800>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001BD19DCB770>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001BD19A85D10>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001BD19DC8050>
          └ <function wrap_app_handling_exceptions at 0x000001BD194FB420>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001BD19E37B00>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001BD19DE9800>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001BD19A85D10>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001BD19E37B00>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001BD19DE9800>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001BD19A85D10>>
          └ <fastapi.routing.APIRouter object at 0x000001BD19A85D10>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001BD19E37B00>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001BD19DE9800>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001BD19528B80>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001BD19E37B00>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001BD19DE9800>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001BD19ABC0E0>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001BD19E37B00>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001BD19DE9800>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001BD19DD1950>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001BD19E37BA0>
          └ <function wrap_app_handling_exceptions at 0x000001BD194FB420>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001BD19E37CE0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001BD19DE9800>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x000001BD19E37BA0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x000001BD19DD1950>
                     └ <function get_request_handler.<locals>.app at 0x000001BD19ABE980>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 328, in app
    content = await serialize_response(
                    └ <function serialize_response at 0x000001BD194FB100>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 177, in serialize_response
    raise ResponseValidationError(
          └ <class 'fastapi.exceptions.ResponseValidationError'>

fastapi.exceptions.ResponseValidationError: 3 validation errors:
  {'type': 'missing', 'loc': ('response', 'user'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'access_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}
  {'type': 'missing', 'loc': ('response', 'refresh_token'), 'msg': 'Field required', 'input': HTTPException(status_code=500, detail='验证码错误')}

2025-09-10 15:34:33.314 | INFO     | routers.user:get_smscode:19 - mobile: 18888888995, code: 0176
2025-09-10 17:29:28.178 | ERROR    | utils.auth:decode_refresh_token:81 - Traceback (most recent call last):
  File "D:\workspace\py\PythonProject\JieGou\user_api\utils\auth.py", line 72, in decode_refresh_token
    payload = jwt.decode(token, self.secret, algorithms=['HS256'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\jwt\api_jwt.py", line 222, in decode
    decoded = self.decode_complete(
        jwt,
    ...<8 lines>...
        leeway=leeway,
    )
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\jwt\api_jwt.py", line 167, in decode_complete
    self._validate_claims(
    ~~~~~~~~~~~~~~~~~~~~~^
        payload,
        ^^^^^^^^
    ...<4 lines>...
        subject=subject,
        ^^^^^^^^^^^^^^^^
    )
    ^
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\jwt\api_jwt.py", line 273, in _validate_claims
    self._validate_sub(payload, subject)
    ~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\jwt\api_jwt.py", line 300, in _validate_sub
    raise InvalidSubjectError("Subject must be a string")
jwt.exceptions.InvalidSubjectError: Subject must be a string

2025-09-10 17:50:25.896 | ERROR    | hooks.middlewares:log_middleware:19 - 请求异常: int() argument must be a string, a bytes-like object or a real number, not 'StatusCode'
Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 151, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x000001AAC57FE8E0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream from None
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\main.py", line 19, in <module>
    uvicorn.run(app, host="0.0.0.0", port=8000)
    │       │   └ <fastapi.applications.FastAPI object at 0x000001AAC68086E0>
    │       └ <function run at 0x000001AAC6AA3EC0>
    └ <module 'uvicorn' from 'D:\\workspace\\py\\PythonProject\\JieGou\\user_api\\.venv\\Lib\\site-packages\\uvicorn\\__init__.py'>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\main.py", line 580, in run
    server.run()
    │      └ <function Server.run at 0x000001AAC6A61E40>
    └ <uvicorn.server.Server object at 0x000001AAC69A74D0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x000001AAC6A61EE0>
           │       │   └ <uvicorn.server.Server object at 0x000001AAC69A74D0>
           │       └ <function run at 0x000001AAC5230B80>
           └ <module 'asyncio' from 'D:\\develop_envs\\python\\Lib\\asyncio\\__init__.py'>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x000001AAC6A37CA0>
           │      └ <function Runner.run at 0x000001AAC5268180>
           └ <asyncio.runners.Runner object at 0x000001AAC69A7770>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-pack...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x000001AAC5261BC0>
           │    └ <ProactorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x000001AAC69A7770>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 706, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x000001AAC5261B20>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 677, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x000001AAC5263920>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 2034, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x000001AAC51D96C0>
    └ <Handle Task.task_wakeup()>
  File "D:\develop_envs\python\Lib\asyncio\events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup()>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\protocols\http\h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001AAC6AD5010>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001AAC7BA4EF0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001AAC7BA4...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x000001AAC68086E0>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x000001AAC6AD5010>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001AAC7BA4EF0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001AAC7BA4...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001AAC7BA4EF0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001AAC7BA4...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001AAC6AD57F0>
          └ <fastapi.applications.FastAPI object at 0x000001AAC68086E0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x000001AAC6B7E2A0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x000001AAC7BA4...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001AAC6AD56A0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x000001AAC6AD57F0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001AAC7BA11C0>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x000001AAC7BA5130>
                     │    └ <function log_middleware at 0x000001AAC65B2020>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001AAC6AD56A0>

> File "D:\workspace\py\PythonProject\JieGou\user_api\hooks\middlewares.py", line 15, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x000001AAC7BA5130>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x000001AAC7BA11C0>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    raise app_exc
          └ TypeError("int() argument must be a string, a bytes-like object or a real number, not 'StatusCode'")
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001AAC7BA2200>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001AAC7BA2160>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001AAC69A6F90>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x000001AAC6AD56A0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x000001AAC7BA2200>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001AAC7BA2160>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x000001AAC6B4B850>
          │                            │    └ <fastapi.routing.APIRouter object at 0x000001AAC6787110>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x000001AAC69A6F90>
          └ <function wrap_app_handling_exceptions at 0x000001AAC61BB420>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001AAC7BA25C0>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001AAC7BA2160>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x000001AAC6787110>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001AAC7BA25C0>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001AAC7BA2160>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x000001AAC6787110>>
          └ <fastapi.routing.APIRouter object at 0x000001AAC6787110>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001AAC7BA25C0>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001AAC7BA2160>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x000001AAC61E8B80>
          └ APIRoute(path='/user/update/username', name='update_username', methods=['PUT'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001AAC7BA25C0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001AAC7BA2160>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x000001AAC6811080>
          └ APIRoute(path='/user/update/username', name='update_username', methods=['PUT'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x000001AAC7BA25C0>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x000001AAC7BA2160>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x000001AAC6B5B2F0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x000001AAC7BA2660>
          └ <function wrap_app_handling_exceptions at 0x000001AAC61BB420>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 59, in wrapped_app
    response = await handler(conn, exc)
                     │       └ <starlette.requests.Request object at 0x000001AAC6B5B2F0>
                     └ <function http_exception_handler at 0x000001AAC61EBCE0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\exception_handlers.py", line 13, in http_exception_handler
    if not is_body_allowed_for_status_code(exc.status_code):
           │                               │   └ <StatusCode.UNAVAILABLE: (14, 'unavailable')>
           │                               └ HTTPException(status_code=<StatusCode.UNAVAILABLE: (14, 'unavailable')>, detail='failed to connect to all addresses; last err...
           └ <function is_body_allowed_for_status_code at 0x000001AAC616EF20>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\utils.py", line 55, in is_body_allowed_for_status_code
    current_status_code = int(status_code)
                              └ <StatusCode.UNAVAILABLE: (14, 'unavailable')>

TypeError: int() argument must be a string, a bytes-like object or a real number, not 'StatusCode'
2025-09-11 11:20:22.620 | ERROR    | hooks.middlewares:log_middleware:19 - 请求异常: Error 22 connecting to localhost:6379. 远程计算机拒绝网络连接。.
Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 151, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x00000195F9B72020>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream from None
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\main.py", line 21, in <module>
    uvicorn.run(app, host="0.0.0.0", port=8000)
    │       │   └ <fastapi.applications.FastAPI object at 0x00000195FBD7A900>
    │       └ <function run at 0x00000195FBED7600>
    └ <module 'uvicorn' from 'D:\\workspace\\py\\PythonProject\\JieGou\\user_api\\.venv\\Lib\\site-packages\\uvicorn\\__init__.py'>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\main.py", line 580, in run
    server.run()
    │      └ <function Server.run at 0x00000195FBED7880>
    └ <uvicorn.server.Server object at 0x00000195FBED17F0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x00000195FBED7920>
           │       │   └ <uvicorn.server.Server object at 0x00000195FBED17F0>
           │       └ <function run at 0x00000195F95D8A40>
           └ <module 'asyncio' from 'D:\\develop_envs\\python\\Lib\\asyncio\\__init__.py'>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000195FBEC9540>
           │      └ <function Runner.run at 0x00000195F96100E0>
           └ <asyncio.runners.Runner object at 0x00000195FBED1A90>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-pack...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x00000195F9605B20>
           │    └ <ProactorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000195FBED1A90>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 706, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000195F9605A80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 677, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000195F9607880>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 2034, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000195F95A1580>
    └ <Handle Task.task_wakeup()>
  File "D:\develop_envs\python\Lib\asyncio\events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup()>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\protocols\http\h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000195FBED30E0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000195FBF89A90>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000195FBF89...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x00000195FBD7A900>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000195FBED30E0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000195FBF89A90>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000195FBF89...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000195FBF89A90>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000195FBF89...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000195FBED3A10>
          └ <fastapi.applications.FastAPI object at 0x00000195FBD7A900>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000195FBFA5440>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000195FBF89...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000195FBED38C0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000195FBED3A10>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000195FBFA5580>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x00000195FBF89940>
                     │    └ <function log_middleware at 0x00000195FA955580>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000195FBED38C0>

> File "D:\workspace\py\PythonProject\JieGou\user_api\hooks\middlewares.py", line 15, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x00000195FBF89940>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000195FBFA5580>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    raise app_exc
          └ ConnectionError('Error 22 connecting to localhost:6379. 远程计算机拒绝网络连接。.')
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000195FBFA5760>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FBFA5A80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000195FBED3770>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000195FBED38C0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000195FBFA5760>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FBFA5A80>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x00000195FBF8AF90>
          │                            │    └ <fastapi.routing.APIRouter object at 0x00000195FBD3D590>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000195FBED3770>
          └ <function wrap_app_handling_exceptions at 0x00000195FA4EDE40>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000195FC01BD80>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FBFA5A80>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x00000195FBD3D590>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000195FC01BD80>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FBFA5A80>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x00000195FBD3D590>>
          └ <fastapi.routing.APIRouter object at 0x00000195FBD3D590>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000195FC01BD80>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FBFA5A80>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000195FA4EF560>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000195FC01BD80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FBFA5A80>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x00000195FBD45BC0>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000195FC01BD80>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FBFA5A80>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x00000195FBF81810>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x00000195FC01BE20>
          └ <function wrap_app_handling_exceptions at 0x00000195FA4EDE40>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000195FC01BF60>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FBFA5A80>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x00000195FC01BE20>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x00000195FBF81810>
                     └ <function get_request_handler.<locals>.app at 0x00000195FBD45C60>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000195FA4ED4E0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'data': LoginModel(mobile='18888888995', code='8888')}
                 │         └ <function login at 0x00000195FBD449A0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=Body(Pydant...

  File "D:\workspace\py\PythonProject\JieGou\user_api\routers\user.py", line 31, in login
    cache_code = await TllRedis().get_sms_code(mobile)
                       │                       └ '18888888995'
                       └ <class 'utils.cache.TllRedis'>

  File "D:\workspace\py\PythonProject\JieGou\user_api\utils\cache.py", line 25, in get_sms_code
    return await self.get(f"{self.SMS_CODE_PREFIX}{mobile}")
                 │    │      │    │                └ '18888888995'
                 │    │      │    └ 'sms_code_'
                 │    │      └ <utils.cache.TllRedis object at 0x00000195FBF8BA10>
                 │    └ <function TllRedis.get at 0x00000195FA954040>
                 └ <utils.cache.TllRedis object at 0x00000195FBF8BA10>

  File "D:\workspace\py\PythonProject\JieGou\user_api\utils\cache.py", line 14, in get
    value = await self.client.get(key)
                  │    │      │   └ 'sms_code_18888888995'
                  │    │      └ <function BasicKeyCommands.get at 0x00000195FA8A8C20>
                  │    └ <redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(db=0,username=None,...
                  └ <utils.cache.TllRedis object at 0x00000195FBF8BA10>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\redis\asyncio\client.py", line 672, in execute_command
    conn = self.connection or await pool.get_connection()
           │    │                   │    └ <function ConnectionPool.get_connection at 0x00000195FA802980>
           │    │                   └ <redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(db=0,username=None,password=None,credential_pro...
           │    └ None
           └ <redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(db=0,username=None,...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\redis\asyncio\connection.py", line 1149, in get_connection
    await self.ensure_connection(connection)
          │    │                 └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
          │    └ <function ConnectionPool.ensure_connection at 0x00000195FA802B60>
          └ <redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(db=0,username=None,password=None,credential_pro...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\redis\asyncio\connection.py", line 1182, in ensure_connection
    await connection.connect()
          │          └ <function AbstractConnection.connect at 0x00000195FA8007C0>
          └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\redis\asyncio\connection.py", line 296, in connect
    await self.connect_check_health(check_health=True)
          │    └ <function AbstractConnection.connect_check_health at 0x00000195FA800860>
          └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\redis\asyncio\connection.py", line 315, in connect_check_health
    raise ConnectionError(self._error_message(e))
          │               │    └ <function AbstractConnection._error_message at 0x00000195FA800A40>
          │               └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
          └ <class 'redis.exceptions.ConnectionError'>

redis.exceptions.ConnectionError: Error 22 connecting to localhost:6379. 远程计算机拒绝网络连接。.
2025-09-11 11:20:33.989 | ERROR    | hooks.middlewares:log_middleware:19 - 请求异常: Error 22 connecting to localhost:6379. 远程计算机拒绝网络连接。.
Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 151, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x00000195F9B72020>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream from None
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\main.py", line 21, in <module>
    uvicorn.run(app, host="0.0.0.0", port=8000)
    │       │   └ <fastapi.applications.FastAPI object at 0x00000195FBD7A900>
    │       └ <function run at 0x00000195FBED7600>
    └ <module 'uvicorn' from 'D:\\workspace\\py\\PythonProject\\JieGou\\user_api\\.venv\\Lib\\site-packages\\uvicorn\\__init__.py'>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\main.py", line 580, in run
    server.run()
    │      └ <function Server.run at 0x00000195FBED7880>
    └ <uvicorn.server.Server object at 0x00000195FBED17F0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x00000195FBED7920>
           │       │   └ <uvicorn.server.Server object at 0x00000195FBED17F0>
           │       └ <function run at 0x00000195F95D8A40>
           └ <module 'asyncio' from 'D:\\develop_envs\\python\\Lib\\asyncio\\__init__.py'>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000195FBEC9540>
           │      └ <function Runner.run at 0x00000195F96100E0>
           └ <asyncio.runners.Runner object at 0x00000195FBED1A90>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-pack...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x00000195F9605B20>
           │    └ <ProactorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000195FBED1A90>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 706, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000195F9605A80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 677, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000195F9607880>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 2034, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000195F95A1580>
    └ <Handle Task.task_wakeup()>
  File "D:\develop_envs\python\Lib\asyncio\events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup()>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\protocols\http\h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000195FBED30E0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000195FC02D1D0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000195FC02D...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x00000195FBD7A900>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000195FBED30E0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000195FC02D1D0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000195FC02D...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000195FC02D1D0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000195FC02D...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000195FBED3A10>
          └ <fastapi.applications.FastAPI object at 0x00000195FBD7A900>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000195FC0211C0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000195FC02D...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000195FBED38C0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000195FBED3A10>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000195FC45E480>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x00000195FBF274D0>
                     │    └ <function log_middleware at 0x00000195FA955580>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000195FBED38C0>

> File "D:\workspace\py\PythonProject\JieGou\user_api\hooks\middlewares.py", line 15, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x00000195FBF274D0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000195FC45E480>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    raise app_exc
          └ ConnectionError('Error 22 connecting to localhost:6379. 远程计算机拒绝网络连接。.')
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000195FC45E160>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FBFA59E0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000195FBED3770>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000195FBED38C0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000195FC45E160>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FBFA59E0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x00000195FBF5AB10>
          │                            │    └ <fastapi.routing.APIRouter object at 0x00000195FBD3D590>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000195FBED3770>
          └ <function wrap_app_handling_exceptions at 0x00000195FA4EDE40>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000195FC45E340>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FBFA59E0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x00000195FBD3D590>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000195FC45E340>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FBFA59E0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x00000195FBD3D590>>
          └ <fastapi.routing.APIRouter object at 0x00000195FBD3D590>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000195FC45E340>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FBFA59E0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000195FA4EF560>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000195FC45E340>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FBFA59E0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x00000195FBD45BC0>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000195FC45E340>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FBFA59E0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x00000195FBF5AC40>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x00000195FC45E3E0>
          └ <function wrap_app_handling_exceptions at 0x00000195FA4EDE40>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000195FC45E200>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FBFA59E0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x00000195FC45E3E0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x00000195FBF5AC40>
                     └ <function get_request_handler.<locals>.app at 0x00000195FBD45C60>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000195FA4ED4E0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'data': LoginModel(mobile='18888888995', code='8888')}
                 │         └ <function login at 0x00000195FBD449A0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=Body(Pydant...

  File "D:\workspace\py\PythonProject\JieGou\user_api\routers\user.py", line 31, in login
    cache_code = await TllRedis().get_sms_code(mobile)
                       │                       └ '18888888995'
                       └ <class 'utils.cache.TllRedis'>

  File "D:\workspace\py\PythonProject\JieGou\user_api\utils\cache.py", line 25, in get_sms_code
    return await self.get(f"{self.SMS_CODE_PREFIX}{mobile}")
                 │    │      │    │                └ '18888888995'
                 │    │      │    └ 'sms_code_'
                 │    │      └ <utils.cache.TllRedis object at 0x00000195FBF8BA10>
                 │    └ <function TllRedis.get at 0x00000195FA954040>
                 └ <utils.cache.TllRedis object at 0x00000195FBF8BA10>

  File "D:\workspace\py\PythonProject\JieGou\user_api\utils\cache.py", line 14, in get
    value = await self.client.get(key)
                  │    │      │   └ 'sms_code_18888888995'
                  │    │      └ <function BasicKeyCommands.get at 0x00000195FA8A8C20>
                  │    └ <redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(db=0,username=None,...
                  └ <utils.cache.TllRedis object at 0x00000195FBF8BA10>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\redis\asyncio\client.py", line 672, in execute_command
    conn = self.connection or await pool.get_connection()
           │    │                   │    └ <function ConnectionPool.get_connection at 0x00000195FA802980>
           │    │                   └ <redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(db=0,username=None,password=None,credential_pro...
           │    └ None
           └ <redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(db=0,username=None,...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\redis\asyncio\connection.py", line 1149, in get_connection
    await self.ensure_connection(connection)
          │    │                 └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
          │    └ <function ConnectionPool.ensure_connection at 0x00000195FA802B60>
          └ <redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(db=0,username=None,password=None,credential_pro...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\redis\asyncio\connection.py", line 1182, in ensure_connection
    await connection.connect()
          │          └ <function AbstractConnection.connect at 0x00000195FA8007C0>
          └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\redis\asyncio\connection.py", line 296, in connect
    await self.connect_check_health(check_health=True)
          │    └ <function AbstractConnection.connect_check_health at 0x00000195FA800860>
          └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\redis\asyncio\connection.py", line 315, in connect_check_health
    raise ConnectionError(self._error_message(e))
          │               │    └ <function AbstractConnection._error_message at 0x00000195FA800A40>
          │               └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
          └ <class 'redis.exceptions.ConnectionError'>

redis.exceptions.ConnectionError: Error 22 connecting to localhost:6379. 远程计算机拒绝网络连接。.
2025-09-11 11:21:05.333 | ERROR    | hooks.middlewares:log_middleware:19 - 请求异常: Error 22 connecting to localhost:6379. 远程计算机拒绝网络连接。.
Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 151, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x00000195F9B72020>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\anyio\streams\memory.py", line 126, in receive
    raise EndOfStream from None
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "D:\workspace\py\PythonProject\JieGou\user_api\main.py", line 21, in <module>
    uvicorn.run(app, host="0.0.0.0", port=8000)
    │       │   └ <fastapi.applications.FastAPI object at 0x00000195FBD7A900>
    │       └ <function run at 0x00000195FBED7600>
    └ <module 'uvicorn' from 'D:\\workspace\\py\\PythonProject\\JieGou\\user_api\\.venv\\Lib\\site-packages\\uvicorn\\__init__.py'>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\main.py", line 580, in run
    server.run()
    │      └ <function Server.run at 0x00000195FBED7880>
    └ <uvicorn.server.Server object at 0x00000195FBED17F0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\server.py", line 67, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ None
           │       │   │    └ <function Server.serve at 0x00000195FBED7920>
           │       │   └ <uvicorn.server.Server object at 0x00000195FBED17F0>
           │       └ <function run at 0x00000195F95D8A40>
           └ <module 'asyncio' from 'D:\\develop_envs\\python\\Lib\\asyncio\\__init__.py'>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 195, in run
    return runner.run(main)
           │      │   └ <coroutine object Server.serve at 0x00000195FBEC9540>
           │      └ <function Runner.run at 0x00000195F96100E0>
           └ <asyncio.runners.Runner object at 0x00000195FBED1A90>
  File "D:\develop_envs\python\Lib\asyncio\runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           │    │     │                  └ <Task pending name='Task-1' coro=<Server.serve() running at D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-pack...
           │    │     └ <function BaseEventLoop.run_until_complete at 0x00000195F9605B20>
           │    └ <ProactorEventLoop running=True closed=False debug=False>
           └ <asyncio.runners.Runner object at 0x00000195FBED1A90>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 706, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x00000195F9605A80>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 677, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x00000195F9607880>
    └ <ProactorEventLoop running=True closed=False debug=False>
  File "D:\develop_envs\python\Lib\asyncio\base_events.py", line 2034, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x00000195F95A1580>
    └ <Handle Task.task_wakeup()>
  File "D:\develop_envs\python\Lib\asyncio\events.py", line 89, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle Task.task_wakeup()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle Task.task_wakeup()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle Task.task_wakeup()>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\protocols\http\h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000195FBED30E0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\uvicorn\middleware\proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000195FBF5BBB0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000195FBF5B...
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x00000195FBD7A900>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x00000195FBED30E0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000195FBF5BBB0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000195FBF5B...
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000195FBF5BBB0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000195FBF5B...
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000195FBED3A10>
          └ <fastapi.applications.FastAPI object at 0x00000195FBD7A900>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x00000195FBFA5620>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x00000195FBF5B...
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000195FBED38C0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x00000195FBED3A10>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000195FC45E660>
                     │    │             └ <starlette.middleware.base._CachedRequest object at 0x00000195FBF5BCE0>
                     │    └ <function log_middleware at 0x00000195FA955580>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000195FBED38C0>

> File "D:\workspace\py\PythonProject\JieGou\user_api\hooks\middlewares.py", line 15, in log_middleware
    response = await call_next(request)
                     │         └ <starlette.middleware.base._CachedRequest object at 0x00000195FBF5BCE0>
                     └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x00000195FC45E660>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 159, in call_next
    raise app_exc
          └ ConnectionError('Error 22 connecting to localhost:6379. 远程计算机拒绝网络连接。.')
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
          │    │   │      │                      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000195FC45E2A0>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FC45E5C0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000195FBED3770>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x00000195FBED38C0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
          │                            │    │    │     │      │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.send_no_error at 0x00000195FC45E2A0>
          │                            │    │    │     │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FC45E5C0>
          │                            │    │    │     └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    │    └ <starlette.requests.Request object at 0x00000195FBF9C160>
          │                            │    └ <fastapi.routing.APIRouter object at 0x00000195FBD3D590>
          │                            └ <starlette.middleware.exceptions.ExceptionMiddleware object at 0x00000195FBED3770>
          └ <function wrap_app_handling_exceptions at 0x00000195FA4EDE40>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000195FC45EE80>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FC45E5C0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <fastapi.routing.APIRouter object at 0x00000195FBD3D590>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000195FC45EE80>
          │    │                │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FC45E5C0>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <bound method Router.app of <fastapi.routing.APIRouter object at 0x00000195FBD3D590>>
          └ <fastapi.routing.APIRouter object at 0x00000195FBD3D590>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 736, in app
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000195FC45EE80>
          │     │      │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FC45E5C0>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x00000195FA4EF560>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 290, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000195FC45EE80>
          │    │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FC45E5C0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x00000195FBD45BC0>
          └ APIRoute(path='/user/login', name='login', methods=['POST'])
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
          │                            │    │        │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000195FC45EE80>
          │                            │    │        │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FC45E5C0>
          │                            │    │        └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │                            │    └ <starlette.requests.Request object at 0x00000195FBF9DAE0>
          │                            └ <function request_response.<locals>.app.<locals>.app at 0x00000195FC45EF20>
          └ <function wrap_app_handling_exceptions at 0x00000195FA4EDE40>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
          │   │      │        └ <function wrap_app_handling_exceptions.<locals>.wrapped_app.<locals>.sender at 0x00000195FC45F240>
          │   │      └ <function BaseHTTPMiddleware.__call__.<locals>.call_next.<locals>.receive_or_disconnect at 0x00000195FC45E5C0>
          │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          └ <function request_response.<locals>.app.<locals>.app at 0x00000195FC45EF20>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\starlette\routing.py", line 75, in app
    response = await f(request)
                     │ └ <starlette.requests.Request object at 0x00000195FBF9DAE0>
                     └ <function get_request_handler.<locals>.app at 0x00000195FBD45C60>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 302, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x00000195FA4ED4E0>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\fastapi\routing.py", line 213, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'data': LoginModel(mobile='18888888995', code='8888')}
                 │         └ <function login at 0x00000195FBD449A0>
                 └ Dependant(path_params=[], query_params=[], header_params=[], cookie_params=[], body_params=[ModelField(field_info=Body(Pydant...

  File "D:\workspace\py\PythonProject\JieGou\user_api\routers\user.py", line 31, in login
    cache_code = await TllRedis().get_sms_code(mobile)
                       │                       └ '18888888995'
                       └ <class 'utils.cache.TllRedis'>

  File "D:\workspace\py\PythonProject\JieGou\user_api\utils\cache.py", line 25, in get_sms_code
    return await self.get(f"{self.SMS_CODE_PREFIX}{mobile}")
                 │    │      │    │                └ '18888888995'
                 │    │      │    └ 'sms_code_'
                 │    │      └ <utils.cache.TllRedis object at 0x00000195FBF8BA10>
                 │    └ <function TllRedis.get at 0x00000195FA954040>
                 └ <utils.cache.TllRedis object at 0x00000195FBF8BA10>

  File "D:\workspace\py\PythonProject\JieGou\user_api\utils\cache.py", line 14, in get
    value = await self.client.get(key)
                  │    │      │   └ 'sms_code_18888888995'
                  │    │      └ <function BasicKeyCommands.get at 0x00000195FA8A8C20>
                  │    └ <redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(db=0,username=None,...
                  └ <utils.cache.TllRedis object at 0x00000195FBF8BA10>

  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\redis\asyncio\client.py", line 672, in execute_command
    conn = self.connection or await pool.get_connection()
           │    │                   │    └ <function ConnectionPool.get_connection at 0x00000195FA802980>
           │    │                   └ <redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(db=0,username=None,password=None,credential_pro...
           │    └ None
           └ <redis.asyncio.client.Redis(<redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(db=0,username=None,...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\redis\asyncio\connection.py", line 1149, in get_connection
    await self.ensure_connection(connection)
          │    │                 └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
          │    └ <function ConnectionPool.ensure_connection at 0x00000195FA802B60>
          └ <redis.asyncio.connection.ConnectionPool(<redis.asyncio.connection.Connection(db=0,username=None,password=None,credential_pro...
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\redis\asyncio\connection.py", line 1182, in ensure_connection
    await connection.connect()
          │          └ <function AbstractConnection.connect at 0x00000195FA8007C0>
          └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\redis\asyncio\connection.py", line 296, in connect
    await self.connect_check_health(check_health=True)
          │    └ <function AbstractConnection.connect_check_health at 0x00000195FA800860>
          └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
  File "D:\workspace\py\PythonProject\JieGou\user_api\.venv\Lib\site-packages\redis\asyncio\connection.py", line 315, in connect_check_health
    raise ConnectionError(self._error_message(e))
          │               │    └ <function AbstractConnection._error_message at 0x00000195FA800A40>
          │               └ <redis.asyncio.connection.Connection(host=localhost,port=6379,db=0)>
          └ <class 'redis.exceptions.ConnectionError'>

redis.exceptions.ConnectionError: Error 22 connecting to localhost:6379. 远程计算机拒绝网络连接。.
